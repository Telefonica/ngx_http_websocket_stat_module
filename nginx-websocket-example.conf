server {
    listen 80;
    server_name localhost;

    # WebSocket logging configuration
    ws_log /dev/stdout;
    ws_log_format '{ "time": "$time_iso8601", "opcode": "$ws_opcode", "remote_addr": "$remote_addr", "packet_source": "$ws_packet_source", "packet_size", "$ws_payload_size", "msg": "$uri", "upstream": "$upstream_addr", "ws_age": "$ws_conn_age", "path": "$uri", "request": "$request" }';
    ws_log_format open '{ "time": "$time_iso8601", "opcode": "$ws_opcode", "remote_addr": "$remote_addr", "msg": "WebSocket connection opened", "upstream": "$upstream_addr", path": "$uri", "request": "$request" }';
    ws_log_format close '{ "time": "$time_iso8601", "opcode": "$ws_opcode", "remote_addr": "$remote_addr", "msg": "WebSocket connection closed", "upstream": "$upstream_addr", "path": "$uri",  "request": "$request" }';
    
    # Maximum concurrent websocket connections
    ws_max_connections 200;
    
    # Maximum connection lifetime
    ws_conn_age 12h;

    # WebSocket status endpoint
    location /websocket_status {
        ws_stat;
    }

    # Example WebSocket proxy location
    location /ws {
        proxy_pass http://backend;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # Regular HTTP location
    location / {
        root /usr/share/nginx/html;
        index index.html index.htm;
    }
}

upstream backend {
    server backend:8080;
}